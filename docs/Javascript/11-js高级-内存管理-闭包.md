# 1. 内存管理

### 1.1 认识管理

- 不管什么编程语言，在执行代码的过程中都会分配内存，只是有些编程语言是手动分配，有些自动分配而已；
- 内存管理的生命周期：
  - 第一步：分配申请需要用到的内存；
  - 第二步：使用分配的内存；
  - 第三步：不需要时，将其释放。
- 手动管理内存语言与自动管理内存语言：
  - 手动：C、C++、OC等；
  - 自动：JAVA、JavaScript、Python等
- 在js中，内存的管理是自动的，无形的，js引擎会自动将其管理。

### 1.2 JS的内存管理

- js会在定义数据（变量）时分配内存；
- **JS在分配原始类型的数据时，是直接分配到栈空间的；**
- **在分配复杂类型数据时，是在堆内存中开辟一块空间，然后将其空间的指针返回给变量引用。**
- ![image-20220708203335434](/Users/wu/Library/Application%20Support/typora-user-images/image-20220708203335434.png)

### 1.3 JS的垃圾回收

- 因为内存的大小是有限的，因此需要在不需要用到内存时，将其释放。

- 现多数的编程语言都有对应的垃圾回收机制：

  - 垃圾回收的英文为Garbage Collection，简称GC；
  - 对于不需要使用的对象，则被称之为垃圾，需要被回收，以此来释放内存空间；

- **常见的GC算法：**

  1. **引用计数算法：**

     - 当一个对象由一个引用指向时，则该对象的引用+1；
     - 当指向为0时，进行销毁；
     - 弊端：会产生循环引用：
     - ![image-20220708203726743](/Users/wu/Library/Application%20Support/typora-user-images/image-20220708203726743.png)

  2. **标记清楚算法**

     - 标记清楚算法的核心是可达性；
     - 该算法会设置一个根对象，垃圾回收器会定时从这个根对象开始，找到所有能从根对象有引用的对象，没有引用的对象则被回收；
     - **可以很好的解决循环引用问题。**
     - ![image-20220708203912515](/Users/wu/Library/Application%20Support/typora-user-images/image-20220708203912515.png)

  3. **其余算法：**

     ![image-20220708203934929](/Users/wu/Library/Application%20Support/typora-user-images/image-20220708203934929.png)

# 2. 闭包

### 2.1 认识闭包

- 维基百科定义：
  - 闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures）；
  -  是在支持  头等函数  的编程语言中，实现词法绑定的一种技术；
  -  闭包在实现上是一个结构体，它存储了一个函数和一个关联的环境（相当于一个符号查找表）；
  - 闭包跟函数最大的区别在于，当捕捉闭包的时候，它的  自由变量  会在捕捉时被确定，这样即使脱离了捕捉时的上下文，它也能照常运行；
- MDN定义：
  - 一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）；
  -  也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域；
  - 在  JavaScript 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来；
- **总结定义：**
  - **如果一个函数能够访问到外层作用域的变量，则该函数和周围的环境则是一个闭包**
  - **广义角度：每一个函数都是闭包；**
  - **狭义角度：只有一个函数访问了外层作用域的变量，该函数才是闭包。**

### 2.2 闭包内存泄漏以及解决内存泄漏

- 如果一个函数执行完之后不在使用了，但该函数的AO对象始终与父作用域的AO一直引用着，则会产生内存泄漏；
- **解决内存泄漏：将该函数的引用设置为null，这样该函数的可达性则消失，会在GC给回收掉。**
- **V8引擎的优化：如果一个函数的其余属性没被访问，则v8引擎会将其释放掉。**



